<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LOGIN</title>
  </head>

  <style>
    label {
      margin-right: 0.5rem;
    }

    .row {
      display: flex;
      flex-direction: row;
      padding-block: 0.5rem;
    }

    .justify-center {
      justify-content: center;
    }

    .center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
  <script>
    async function onWebSocket() {
      const socket = new WebSocket('wss://localhost:8200/api/notify');

      socket.onopen = () => {
        alert('WS SENT');
        socket.send('SENT');
      };

      socket.onmessage = () => {
        alert('WS RECEIVED');
      };
    }
    async function onLogin() {
      const { fetch } = window;
      const docUsername = document.querySelector('#id_username');
      const docPassword = document.querySelector('#id_password');
      const { value: username } = docUsername;
      const { value: password } = docPassword;

      const Authentication = JSON.stringify({
        username,
        password,
      });

      const headers = {
        method: 'GET',
        headers: {
          'Content-type': 'application/json; charset=UTF-8',
          Authentication,
        },
      };

      const response = await fetch('/api/login', headers);
      const json = await response.json();

      console.log(json);

      if (json) {
        onWebSocket();
      }
    }
  </script>
  <body>
    <div class="center">
      <form action="">
        <div class="row justify-center">
          <label for="">Username</label>
          <input type="text" name="name_username" id="id_username" />
        </div>
        <div class="row justify-center">
          <label for="">Password</label>
          <input type="password" name="name_password" id="id_password" />
        </div>
        <div class="row justify-center">
          <input type="button" value="Submit" onclick="onLogin()" />
        </div>
      </form>
    </div>
  </body>
</html>
